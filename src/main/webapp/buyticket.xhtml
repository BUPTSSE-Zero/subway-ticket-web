<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:w="http://java.sun.com/jsf/composite/widgets"
                template="/templates/main-template.xhtml">

    <ui:define name="login-button">
        <p:commandButton styleClass="submit-button btn waves-effect waves-light amber" type="submit"
                         value="#{bundle.Login}" actionListener="#{userOperationBean.login}" icon="ui-icon-enter"
                         update="normal-buyticket-panel login_error_message header-panel" oncomplete="handleLoginResult(xhr, status, args)">
            <f:actionListener binding="#{buyTicketBean.findUser()}"/>
            <f:actionListener binding="#{subwayInfoBean.findUser()}"/>
            <f:actionListener binding="#{preferBean.findUser()}"/>
            <f:actionListener binding="#{orderBean.findUser()}"/>
        </p:commandButton>
    </ui:define>

    <ui:define name="logout-button">
        <p:commandButton styleClass="btn transparent z-depth-0 black-text" actionListener="#{userOperationBean.logout}" value="#{bundle.Logout}"
                         style="float: left; height: 50px; line-height: 50px; text-align: left; padding: 0"
                         update="normal-buyticket-panel header-panel">
            <f:actionListener binding="#{buyTicketBean.findUser()}"/>
            <f:actionListener binding="#{subwayInfoBean.findUser()}"/>
            <f:actionListener binding="#{preferBean.findUser()}"/>
            <f:actionListener binding="#{orderBean.findUser()}"/>
        </p:commandButton>
    </ui:define>

    <ui:define name="page-panel-content">
        <h:outputScript library="js" name="station-msg.js"/>
        <h:outputScript library="js" name="order-callback.js"/>
        <script type="text/javascript">
            $(document).ready(function() {
                $('select').material_select();
            });
        </script>
        <div style="padding: 15px 7%">
            <div class="row" style="margin-bottom: 0">
                <h:form class="col s12">
                    <div class="row" style="margin-bottom: 0">
                        <div class="col s2">
                            <div class="col" style="padding: 20px 6px 0 0;">
                                <i class="material-icons">location_city</i>
                            </div>
                            <div class="input-field col" style="width: calc(100% - 30px)">
                                <h:selectOneMenu value="#{subwayInfoBean.selectedCityId}">
                                    <c:forEach items="#{subwayInfoBean.cities}" var="city">
                                        <f:selectItem itemLabel="#{city.cityName}" itemValue="#{city.cityId}"/>
                                    </c:forEach>
                                    <p:ajax global="false" event="change" listener="#{subwayInfoBean.onSelectedCityIdChange}"
                                            onsuccess="$('#start-station-select input').val(''); $('#end-station-select input').val('')"/>
                                </h:selectOneMenu>
                                <label>#{bundle.City}</label>
                            </div>
                        </div>
                        <div class="col s4">
                            <div class="col" style="padding: 20px 6px 0 0;">
                                <i class="material-icons">subway</i>
                            </div>
                            <div id="start-station-select" class="input-field col" style="width: calc(100% - 30px)">
                                <w:stationAutoComplete value="#{buyTicketBean.startStationId}" id="start-station-autocomplete" stationNameClass="start-station-text"
                                                       enableStationMessage="#{true}" completeMethod="#{subwayInfoBean.searchStation}"
                                                       required="true" requiredMessage="#{bundle.TipSelectStartStation}"
                                                       label="#{bundle.StartSubwayStation}"/>
                            </div>
                        </div>
                        <div class="col s4">
                            <div class="col" style="padding: 20px 5px 0 20px;">
                                <i class="material-icons">trending_flat</i>
                            </div>
                            <div id="end-station-select" class="input-field col" style="width: calc(100% - 50px)">
                                <w:stationAutoComplete id="end-station-autocomplete" value="#{buyTicketBean.endStationId}" stationNameClass="end-station-text"
                                                       enableStationMessage="#{true}" completeMethod="#{subwayInfoBean.searchStation}"
                                                       required="true" requiredMessage="#{bundle.TipSelectEndStation}"
                                                       label="#{bundle.EndSubwayStation}"/>
                            </div>
                        </div>
                        <div class="input-field col s2" style="text-align: right">
                            <p:commandButton styleClass="btn light-green waves-effect waves-light" icon="ui-icon-search" value="#{bundle.Search}"
                                             style="padding-left: 20px; padding-right: 10px"
                                             update="select-station-msg normal-buyticket-panel"
                                             actionListener="#{buyTicketBean.searchTicketPrice}"/>
                        </div>
                    </div>
                    <p:messages id="select-station-msg" closable="true" autoUpdate="false"/>
                </h:form>
            </div>

            <p:outputPanel id="normal-buyticket-panel">
                <c:if test="#{not empty buyTicketBean.ticketPrice}">
                    <w:buyTicketTable id="normal-buyticket-table" endStation="#{buyTicketBean.endStation}"
                                      startStation="#{buyTicketBean.startStation}"
                                      ticketPrice="#{buyTicketBean.ticketPrice}"
                                      preferButtonUpdate="normal-buyticket-panel"/>
                </c:if>
            </p:outputPanel>
        </div>

        <div id="station-msg-dialog" class="modal">
            <div class="modal-content">
                <h5 class="light-blue-text">#{bundle.StationMessage}</h5>
                <div class="station-msg-header">
                    <i class="material-icons left">schedule</i>
                    <span id="station-msg-time" class="left"/>
                    <i class="material-icons left">person</i>
                    <span id="station-msg-publisher" class="left"/>
                </div>
                <p id="station-msg" style="font-size: 18px"/>
            </div>
            <div class="modal-footer">
                <a class="waves-effect waves-green btn-flat" onclick="$('#station-msg-dialog').closeModal()">
                    #{bundle.Close}
                </a>
            </div>
        </div>
        <p:confirmDialog styleClass="confirm-dialog"
                         global="true" showEffect="fade" hideEffect="fade" closable="false" responsive="true" width="600">
            <f:facet name="header">
                <h5 class="light-blue-text">#{bundle.Alert}</h5>
            </f:facet>
            <a class="ui-confirmdialog-yes waves-effect waves-green btn-flat right">#{bundle.Ok}</a>
            <a class="ui-confirmdialog-no waves-effect waves-red btn-flat right">#{bundle.Cancel}</a>
        </p:confirmDialog>
        <div id="order-callback-dialog" class="modal" style="width: 600px;">
            <div class="modal-content">
                <h5 class="light-blue-text">#{bundle.Alert}</h5>
                <p id="order-callback-msg"/>
            </div>
            <div class="modal-footer">
                <a class="waves-effect waves-green btn-flat" onclick="$('#order-callback-dialog').closeModal()">
                    #{bundle.Close}
                </a>
            </div>
        </div>
        <div id="extract-code-dialog" class="modal" style="width: 400px">
            <div class="modal-content">
                <h5 class="light-blue-text">#{bundle.ExtractCode}</h5>
                <p:outputPanel id="extract-code-panel" style="text-align: center">
                    <p:barcode value="#{orderBean.selectedNotExtractTicketOrder.extractCode}" type="qr" format="svg"/>
                    <br/>
                    <span>#{orderBean.selectedNotExtractTicketOrder.extractCode}</span>
                </p:outputPanel>
            </div>
            <div class="modal-footer">
                <a class="waves-effect waves-green btn-flat" type="button"
                   onclick="$('#extract-code-dialog').closeModal();return;">#{bundle.Close}</a>
            </div>
        </div>

    </ui:define>

</ui:composition>
