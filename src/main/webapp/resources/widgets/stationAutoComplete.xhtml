<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <cc:interface>
        <cc:attribute name="id"/>
        <cc:attribute name="label"/>
        <cc:attribute name="completeMethod" method-signature="void searchStation(String)"/>
        <cc:attribute name="stationNameClass"/>
        <cc:attribute name="enableStationMessage"/>
        <cc:attribute name="required" default="false"/>
        <cc:attribute name="value"/>
        <cc:attribute name="requiredMessage" default=""/>
    </cc:interface>

    <cc:implementation>
        <p:autoComplete id="#{cc.attrs.id}" value="#{cc.attrs.value}" styleClass="#{cc.attrs.id} station-autocomplete" style="width: 100%"
                        emptyMessage="#{bundle.NoStationSearchResult}" completeMethod="#{cc.attrs.completeMethod}"
                        forceSelection="true" var="station" itemLabel="#{station.displayName}" dropdown="true"
                        itemValue="#{station.subwayStationId.toString()}" required="#{cc.attrs.required}"
                        requiredMessage="#{cc.attrs.requiredMessage}"
                        placeholder="#{bundle.SupportPinyinSearch}" >
            <c:choose>
                <c:when test="#{cc.attrs.enableStationMessage}">
                    <p:ajax event="query" global="false" oncomplete="initStationMessage('.#{cc.attrs.stationNameClass}')"/>
                    <p:column>
                        <span class="#{cc.attrs.stationNameClass}" data-disable="#{not station.available}" station-msg="#{station.stationMessage.content}"
                              station-msg-time="#{station.stationMessage.releaseTime.time}"
                              station-msg-publisher="#{station.stationMessage.publisher}">
                            #{station.displayName}
                        </span>
                    </p:column>
                </c:when>
                <c:otherwise>
                    <p:ajax event="query" global="false"/>
                    <p:column>
                        <span>
                            #{station.displayName}
                        </span>
                    </p:column>
                </c:otherwise>
            </c:choose>
        </p:autoComplete>

        <script type="text/javascript">
            $('.#{cc.attrs.id}').append('<label>#{cc.attrs.label}</label>');
        </script>
    </cc:implementation>

</html>
